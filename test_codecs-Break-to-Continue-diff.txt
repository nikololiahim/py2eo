574c574
<                         xs.write (((unsupported)).apply ("<%!--===================================================rn") ("    BLOG index page: show recent articles,rn") ("    today's articles, or articles of a specific date.rn") ("========================================================--%>rn") ("<%@inputencoding=\"ISO-8859-1\"%>rn") ("<%@pagetemplate=TEMPLATE.y%>rn") ("<%@import=import frog.util, frog%>rn") ("<%@import=import frog.objects%>rn") ("<%@import=from frog.storageerrors import StorageError%>rn") ("<%rn") ("rn") ("import loggingrn") ("log=logging.getLogger(\"Snakelets.logger\")rn") ("rn") ("rn") ("user=self.SessionCtx.userrn") ("storageEngine=self.SessionCtx.storageEnginern") ("rn") ("rn") ("def readArticlesFromDate(date, count=None):rn") ("    entryids=storageEngine.listBlogEntries(date)rn") ("    entryids.reverse() # descendingrn") ("    if count:rn") ("        entryids=entryids[:count]rn") ("    try:rn") ("        return [ frog.objects.BlogEntry.load(storageEngine, date, Id) for Id in entryids ]rn") ("    except StorageError,x:rn") ("        log.error(\"Error loading articles: \"+str(x))rn") ("        self.abort(\"cannot load articles\")rn") ("rn") ("showdate=Nonern") ("rn") ("arg=self.Request.getArg()rn") ("if arg==\"today\":rn") ("    #-------------------- TODAY'S ARTICLESrn") ("    self.write(\"<h2>Today's articles</h2>\")rn") ("    showdate = frog.util.isodatestr() rn") ("    entries = readArticlesFromDate(showdate)rn") ("elif arg==\"active\":rn") ("    #-------------------- ACTIVE ARTICLES redirectrn") ("    self.Yredirect(\"active.y\")rn") ("elif arg==\"login\":rn") ("    #-------------------- LOGIN PAGE redirectrn") ("    self.Yredirect(\"login.y\")rn") ("elif arg==\"date\":rn") ("    #-------------------- ARTICLES OF A SPECIFIC DATErn") ("    showdate = self.Request.getParameter(\"date\")rn") ("    self.write(\"<h2>Articles written on %s</h2>\"% frog.util.mediumdatestr(showdate))rn") ("    entries = readArticlesFromDate(showdate)rn") ("else:rn") ("    #-------------------- RECENT ARTICLESrn") ("    self.write(\"<h2>Recent articles</h2>\")rn") ("    dates=storageEngine.listBlogEntryDates()rn") ("    if dates:rn") ("        entries=[]rn") ("        SHOWAMOUNT=10rn") ("        for showdate in dates:rn") ("            entries.extend( readArticlesFromDate(showdate, SHOWAMOUNT-len(entries)) )rn") ("            if len(entries)>=SHOWAMOUNT:rn") ("                breakrn") ("                rn"))
---
>                         xs.write (((unsupported)).apply ("<%!--===================================================rn") ("    BLOG index page: show recent articles,rn") ("    today's articles, or articles of a specific date.rn") ("========================================================--%>rn") ("<%@inputencoding=\"ISO-8859-1\"%>rn") ("<%@pagetemplate=TEMPLATE.y%>rn") ("<%@import=import frog.util, frog%>rn") ("<%@import=import frog.objects%>rn") ("<%@import=from frog.storageerrors import StorageError%>rn") ("<%rn") ("rn") ("import loggingrn") ("log=logging.getLogger(\"Snakelets.logger\")rn") ("rn") ("rn") ("user=self.SessionCtx.userrn") ("storageEngine=self.SessionCtx.storageEnginern") ("rn") ("rn") ("def readArticlesFromDate(date, count=None):rn") ("    entryids=storageEngine.listBlogEntries(date)rn") ("    entryids.reverse() # descendingrn") ("    if count:rn") ("        entryids=entryids[:count]rn") ("    try:rn") ("        return [ frog.objects.BlogEntry.load(storageEngine, date, Id) for Id in entryids ]rn") ("    except StorageError,x:rn") ("        log.error(\"Error loading articles: \"+str(x))rn") ("        self.abort(\"cannot load articles\")rn") ("rn") ("showdate=Nonern") ("rn") ("arg=self.Request.getArg()rn") ("if arg==\"today\":rn") ("    #-------------------- TODAY'S ARTICLESrn") ("    self.write(\"<h2>Today's articles</h2>\")rn") ("    showdate = frog.util.isodatestr() rn") ("    entries = readArticlesFromDate(showdate)rn") ("elif arg==\"active\":rn") ("    #-------------------- ACTIVE ARTICLES redirectrn") ("    self.Yredirect(\"active.y\")rn") ("elif arg==\"login\":rn") ("    #-------------------- LOGIN PAGE redirectrn") ("    self.Yredirect(\"login.y\")rn") ("elif arg==\"date\":rn") ("    #-------------------- ARTICLES OF A SPECIFIC DATErn") ("    showdate = self.Request.getParameter(\"date\")rn") ("    self.write(\"<h2>Articles written on %s</h2>\"% frog.util.mediumdatestr(showdate))rn") ("    entries = readArticlesFromDate(showdate)rn") ("else:rn") ("    #-------------------- RECENT ARTICLESrn") ("    self.write(\"<h2>Recent articles</h2>\")rn") ("    dates=storageEngine.listBlogEntryDates()rn") ("    if dates:rn") ("        entries=[]rn") ("        SHOWAMOUNT=10rn") ("        for showdate in dates:rn") ("            entries.extend( readArticlesFromDate(showdate, SHOWAMOUNT-len(entries)) )rn") ("            if len(entries)>=SHOWAMOUNT:rn") ("                continuern") ("                rn"))